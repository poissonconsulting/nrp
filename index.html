<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Kootenay Lake Nutrient Restoration Program Data Loading • nrp</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="katex-auto.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto_Condensed-0.4.10/font.css" rel="stylesheet">
<link href="deps/Roboto_Mono-0.4.10/font.css" rel="stylesheet">
<link href="deps/Playfair_Display-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Kootenay Lake Nutrient Restoration Program Data Loading">
<meta name="description" content="Imports CTD, EMS, Zooplankton, and Mysid data for the Kootenay Lake Nutrient Restoration Program (NRP) and provides functionality for uploading and downloading with an SQLite database.">
<meta property="og:description" content="Imports CTD, EMS, Zooplankton, and Mysid data for the Kootenay Lake Nutrient Restoration Program (NRP) and provides functionality for uploading and downloading with an SQLite database.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">nrp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="nrp">nrp<a class="anchor" aria-label="anchor" href="#nrp"></a>
</h1></div>
<p><code>nrp</code> is an R package developed for the Nutrient Restoration Program (NRP). It currently provides the following functionality for CTD and EMS data:</p>
<p><strong>Read in raw data files</strong><br> The package checks the validity of input data and does some cleaning and manipulation to make the data more informative and useful to the user.</p>
<p>For CTD data, the date and parameter units are extracted from the file meta data. The SiteID is pulled from the raw data filename, and validated by cross referencing it to known sites in the database.</p>
<p><strong>Upload data to the NRP SQLite database</strong><br> When uploading new data to the database, the package checks to ensure that no duplicate data is present, and numerous checks are performed to ensure that the data’s structure is correct and compatible with the database.</p>
<p><strong>Download CTD data</strong><br> Data can then be downloaded from the database with optional filtering by SiteID, date range, etc.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install the latest version from <a href="https://github.com/poissonconsulting/nrp" class="external-link">GitHub</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"poissonconsulting/nrp"</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="demonstration">Demonstration<a class="anchor" aria-label="anchor" href="#demonstration"></a>
</h2>
<p>For simplicity, this demonstration uses the function <code>nrp_create_db</code> to create an empty, temporary database to read and write to, and uses some test data that travels with the package. When connecting to a proper database, just provide the file path to the database for the argument <code>db_path</code> in all function calls and the connection will be made automatically. Alternatively you can connect to a database in R and then supply that connection object for the argument <code>db_path</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(nrp)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># create empty database</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># path = ":memory:" creates a temporary, in memory database</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">nrp_create_db</span>(<span class="at">path =</span> <span class="st">":memory:"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># provide a path to a .cnv file</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"ctd/2018/KL1_27Aug2018008downcast.cnv"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">package =</span> <span class="st">"nrp"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>ctd_data <span class="ot">&lt;-</span> <span class="fu">nrp_read_ctd_file</span>(path, <span class="at">db_path =</span> conn)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; 32 negative depths removed from data</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># upload data to the database</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="fu">nrp_upload_ctd</span>(<span class="at">data =</span> ctd_data, <span class="at">db_path =</span> conn)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; 131 duplicate depths removed from data</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co"># download data from database, filtering by Date and SiteID and parameter</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>db_ctd_data <span class="ot">&lt;-</span> <span class="fu">nrp_download_ctd</span>(</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  <span class="at">start_date =</span> <span class="st">"2018-08-27"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  <span class="at">end_date =</span> <span class="st">"2018-08-27"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>  <span class="at">sites =</span> <span class="st">"KL1"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="st">"all"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>  <span class="at">db_path =</span> conn</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>)</span></code></pre></div>
<p>There are additional functions in the nrp package that allow for easy downloading of other tables in the database.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Lakes and BasinArm tables</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">nrp_download_lakes</span>(<span class="at">db_path =</span> conn)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>basinArm <span class="ot">&lt;-</span> <span class="fu">nrp_download_ctd_basin_arm</span>(<span class="at">db_path =</span> conn)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># site table</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">nrp_download_sites</span>(<span class="at">db_path =</span> conn)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co"># ctd visit table</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>ctd_visit <span class="ot">&lt;-</span> <span class="fu">nrp_download_ctd_visit</span>(<span class="at">db_path =</span> conn)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co"># Tip: the nrp functions can also use global options to automatically know</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co"># what database to connect to. Once you've set the global option "nrp.db_path"</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co"># for the database you want to connect to, you don't have to provide</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co"># the db_path argument any more within that R session</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="fu">options</span>(<span class="at">nrp.db_path =</span> conn) <span class="co"># "conn" can also be a file path to a database</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co"># now we can do things like:</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">nrp_download_lakes</span>()</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co"># we conclude the demo by closing the database connection</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co"># If you are providing a file path to the database, you do not need to do this</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>readwritesqlite<span class="sc">::</span><span class="fu">rws_disconnect</span>(conn)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-help-or-reporting-an-issue">Getting Help or Reporting an Issue<a class="anchor" aria-label="anchor" href="#getting-help-or-reporting-an-issue"></a>
</h2>
<p>To report bugs/issues/feature requests, please file an <a href="https://github.com/poissonconsulting/nrp/issues/" class="external-link">issue</a>.</p>
</div>
<div class="section level2">
<h2 id="how-to-contribute">How to Contribute<a class="anchor" aria-label="anchor" href="#how-to-contribute"></a>
</h2>
<p>If you would like to contribute to the package, please see our <a href="CONTRIBUTING.html">CONTRIBUTING</a> guidelines.</p>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the nrp project is released with a <a href="https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>The code is released under the Apache License 2.0</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>Copyright <span class="dv">2019</span> Province of British Columbia</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>Licensed under the Apache License, Version <span class="fl">2.0</span> (the <span class="st">"License"</span>);</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>you may not use this file except <span class="cf">in</span> compliance with the License.</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>You may obtain a copy of the License at </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>   http<span class="sc">:</span><span class="er">//</span>www.apache.org<span class="sc">/</span>licenses<span class="sc">/</span>LICENSE<span class="fl">-2.0</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>Unless required by applicable law or agreed to <span class="cf">in</span> writing, software</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>distributed under the License is distributed on an <span class="st">"AS IS"</span> BASIS,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>See the License <span class="cf">for</span> the specific language governing permissions and</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>limitations under the License.</span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2.0)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li><a href="SUPPORT.html">Getting help</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nrp</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.poissonconsulting.ca/author/evan-amies-galonski/" class="external-link">Evan Amies-Galonski</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1096-2089" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>
<a href="https://www.poissonconsulting.ca/author/joe-thorley/" class="external-link">Joe Thorley</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-7683-4592" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Province of British Columbia <br><small class="roles"> Copyright holder, funder </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://github.com/poissonconsulting/nrp/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/poissonconsulting/nrp/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/poissonconsulting/nrp" class="external-link"><img src="https://codecov.io/gh/poissonconsulting/nrp/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://opensource.org/licenses/Apache-2.0" class="external-link"><img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" alt="Apache license"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.poissonconsulting.ca/author/evan-amies-galonski/" class="external-link">Evan Amies-Galonski</a>, <a href="https://www.poissonconsulting.ca/author/joe-thorley/" class="external-link">Joe Thorley</a>, Province of British Columbia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

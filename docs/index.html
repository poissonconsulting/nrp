<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kootenay Lake Nutrient Restoration Program Data Loading • nrp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Kootenay Lake Nutrient Restoration Program Data Loading">
<meta property="og:description" content="Imports CTD and EMS data for 
    the Kootenay Lake Nutrient Restoration Program (NRP) and uploads it to to a SQLite database.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">nrp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->

<div id="nrp" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#nrp" class="anchor"></a>nrp</h1></div>
<p><code>nrp</code> is an R package developed for the Nutrient Restoration Program (NRP). It currently provides the following functionality for CTD and EMS data:</p>
<p><strong>Read in raw data files</strong><br> The package checks the validity of input data and does some cleaning and manipulation to make the data more informative and useful to the user.</p>
<p>For CTD data, the date and parameter units are extracted from the file meta data. The SiteID is pulled from the raw data filename, and validated by cross referencing it to known sites in the database.</p>
<p>For EMS data, the data is filtered to only include the parameters and sites of interest for the Nutrient Restoration Program. The data is then restructured in a ‘wide’ format that lends itself to easy analysis/plotting. During the process, parameters are assigned the correct units, and values that were measured as the detection limit are set to 0. Detection limit columns for each parameter are created to inform the user of the detection limit each time a 0 value is encountered.</p>
<p><strong>Upload data to the NRP SQLite database</strong><br> When uploading new data to the database, the package checks to ensure that no duplicate data is present, and numerous checks are performed to ensure that the data’s structure is correct and compatible with the database.</p>
<p><strong>Download CTD data</strong><br> Data can then be downloaded from the database with optional filtering by SiteID, date range, etc.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To install the latest development version from <a href="https://github.com/poissonconsulting/nrp">GitHub</a></p>
<pre><code><a href="https://www.rdocumentation.org/packages/drat/topics/addRepo"># install.packages("drat")
drat::addRepo("poissonconsulting")
devtools::install_github("poissonconsulting/nrp")</a></code></pre>
</div>
<div id="demonstration" class="section level2">
<h2 class="hasAnchor">
<a href="#demonstration" class="anchor"></a>Demonstration</h2>
<p>For simplicity, this demo uses an empty, temporary database to read and write to, and uses some test data that travels with the package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(nrp)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># CTD data</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co"># create empty database with automatically populated Site and BasinArm (Lake) tables</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># path = ":memory:" creates a temporory, in memory database</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">conn &lt;-<span class="st"> </span><span class="kw"><a href="reference/nrp_create_db.html">nrp_create_db</a></span>(<span class="dt">path =</span> <span class="st">":memory:"</span>) </a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># provide a path to a .cnv file</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">path &lt;-<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"ctd/2018/KL1_27Aug2018008downcast.cnv"</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">                       <span class="dt">package =</span> <span class="st">"nrp"</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co"># read in file</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">ctd_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/nrp_read_ctd_file.html">nrp_read_ctd_file</a></span>(path, <span class="dt">db_path =</span> conn)</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; 32 negative depths removed from data</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co"># upload data to the database</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="kw"><a href="reference/nrp_upload_ctd.html">nrp_upload_ctd</a></span>(<span class="dt">data =</span> ctd_data, <span class="dt">db_path =</span> conn)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; 131 duplicate depths removed from data</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co"># download data from database, filtering by Date and SiteID and parameter</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">db_ctd_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/nrp_download_ctd.html">nrp_download_ctd</a></span>(<span class="dt">start_date =</span> <span class="st">"2018-08-27"</span>,</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">                            <span class="dt">end_date =</span> <span class="st">"2018-08-27"</span>,</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">                            <span class="dt">sites =</span> <span class="st">"KL1"</span>,</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">                            <span class="dt">parameters =</span> <span class="st">"all"</span>,</a>
<a class="sourceLine" id="cb2-26" data-line-number="26">                            <span class="dt">db_path =</span> conn)</a>
<a class="sourceLine" id="cb2-27" data-line-number="27"></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co"># EMS data</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co"># read in raw ems data</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32">path &lt;-<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"ems/test_ems.rds"</span>, <span class="dt">package =</span> <span class="st">"nrp"</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-33" data-line-number="33">ems_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(path)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34"></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co"># extract into wide fromat that fits the nrp database, chooing either the</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co"># 'metals' or 'standard' analysis_type</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">ems_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/nrp_extract_ems.html">nrp_extract_ems</a></span>(<span class="dt">data =</span> ems_raw, <span class="dt">db_path =</span> conn, <span class="dt">analysis_type =</span> <span class="st">"standard"</span>)</a>
<a class="sourceLine" id="cb2-38" data-line-number="38"></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co"># upload data to database</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="kw"><a href="reference/nrp_upload_ems_standard.html">nrp_upload_ems_standard</a></span>(<span class="dt">data =</span> ems_data, <span class="dt">db_path =</span> conn)</a>
<a class="sourceLine" id="cb2-41" data-line-number="41"></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co"># download data from database, filtering by Date, SiteID, and analysis_type. </span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co"># You can also choose to exlude detection limit columns</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44">db_ems_data_standard &lt;-<span class="st"> </span><span class="kw"><a href="reference/nrp_download_ems.html">nrp_download_ems</a></span>(<span class="dt">start_date_time =</span> <span class="st">"2018-07-03 13:48:00"</span>,</a>
<a class="sourceLine" id="cb2-45" data-line-number="45">                                     <span class="dt">end_date_time =</span> <span class="st">"2018-07-31 13:28:00"</span>,</a>
<a class="sourceLine" id="cb2-46" data-line-number="46">                                     <span class="dt">sites =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-47" data-line-number="47">                                     <span class="dt">db_path =</span> conn,</a>
<a class="sourceLine" id="cb2-48" data-line-number="48">                                     <span class="dt">analysis_type =</span> <span class="st">"standard"</span>,</a>
<a class="sourceLine" id="cb2-49" data-line-number="49">                                     <span class="dt">show_detection_limits =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-50" data-line-number="50"></a>
<a class="sourceLine" id="cb2-51" data-line-number="51"></a>
<a class="sourceLine" id="cb2-52" data-line-number="52"><span class="co"># close connection</span></a>
<a class="sourceLine" id="cb2-53" data-line-number="53">readwritesqlite<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/readwritesqlite/topics/rws_disconnect">rws_disconnect</a></span>(conn)</a></code></pre></div>
</div>
<div id="getting-help-or-reporting-an-issue" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help-or-reporting-an-issue" class="anchor"></a>Getting Help or Reporting an Issue</h2>
<p>To report bugs/issues/feature requests, please file an <a href="https://github.com/poissonconsulting/nrp/issues/">issue</a>.</p>
</div>
<div id="how-to-contribute" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-contribute" class="anchor"></a>How to Contribute</h2>
<p>If you would like to contribute to the package, please see our <a href="CONTRIBUTING.html">CONTRIBUTING</a> guidelines.</p>
<p>Please note that this project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms</p>
</div>
<div id="license" class="section level2">
<h2 class="hasAnchor">
<a href="#license" class="anchor"></a>License</h2>
<p>The code is released under the Apache License 2.0</p>
<pre><code>Copyright 2015 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at 

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Evan Amies-Galonski <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/-3188" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
<li>Joe Thorley <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-7683-4592" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/BCDevExchange/docs/blob/master/discussion/projectstates.md"><img src="https://assets.bcdevexchange.org/images/badges/exploration.svg" alt="BCDevExchange Status"></a></li>
<li><a href="https://www.travis-ci.com/poissonconsulting/nrp"><img src="https://www.travis-ci.com/poissonconsulting/nrp.svg?token=LCuTqqVUfUECxm1xTQLb&amp;branch=master" alt="Travis Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/joethorley/nrp"><img src="https://ci.appveyor.com/api/projects/status/nf8qrbm7imvkuj0q?svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://codecov.io/gh/poissonconsulting/nrp"><img src="https://codecov.io/gh/poissonconsulting/nrp/branch/master/graph/badge.svg?token=BYPzzOPDrd" alt="codecov"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Evan Amies-Galonski, Joe Thorley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
